---
layout: post
title:  "元智产品生命周期"
categories: galaxy
author: "王耕"
---

**总体设计**

  元智产品生命周期管理系统主要业务将在Galaxy Online上实现与Galaxy系统无关，但相互之间会存在数据通信。online地址：http://cloud.microwise-system.com/
  早期未对出厂设备进行管理，所以公司产品销往何处，运行状况如何一直无法跟踪，且维护麻烦（公式配置等），不能进行统一配置管理，该功能需要实现将出厂产品进行统一管理，统一配置。
  该系统目前主要是公司内部人员使用，不排除以后有其他人员使用。
  
**业务名词解释**

	Online :	指运行在公网的元智产品生命周期管理系统
	agent :	运行于博物馆的业务系统代理端模块简称
	刷机精灵 :	用来烧录硬件程序的元智工具软件
	
**系统约束**	

  接入该系统需要确保各站点agent代理端（或Galaxy系统）能连接到Online服务器。
  
**功能结构**

  ![]({{site.mirror_url}}/assets/uploads/2015-02-25-products-cloud1.jpg)  
  
  注意事项：
  1、服务器管理模型维持Galaxy Online现有功能，不做调整。即agent上报信息至online系统，用于监视服务器运行状态。（可参考：doc/design/《galaxy-online设计-v1.0》）
	2、该系统产品管理模块目标为设备管理，与位置点无关。
	3、位置信息是设备的属性，如：123号设备的位置信息为“陕西历史博物馆/一展厅/XX展柜”（即到该设备所处的位置点层级信息）
	4、产品管理相关功能在银河系统上实现，由银河直接与online通信。
	
**online产品管理模块详细设计**

	产品信息管理:
	现有产品基本信息包括：嵌入式软件版本号，设备类型，协议版本，硬件版本，产品序列号，生产日期，设备ID，设备工作周期，接入点号，设备属性，子节点工作周期，
	控制端口属性等，同时还包括Galaxy系统所承载的信息，如监测指标公式及公式系数等。我们从中提取关键信息作为产品属性在系统中进行维护。
	
	产品信息初始化:
	初始化产品信息功能主要用来在设备生产完成后或出厂时记录设备基本信息，以便统一管理。Online管理的基本信息包括产品序列号，
	PCB型号，嵌入式版本号，硬件版本，协议版本，设备类型，生产日期，设备属性（生产阶段，试用阶段）。
	上述信息通过刷机精灵上传（可参考5“刷机精灵agent模块详细设计”章节），Online实现信息的浏览。
	
	公式管理:
	通过公式管理功能可以在Online上对设备公式进行统一配置。
	
	系统运行状态监视:
	该功能主要根据公司产品信息及用户现场使用情况进行分析统计。
	目前考虑到两个统计点：

	各站点设备统计:
	统计各站点各个设备类型的设备数量，和百分比统计，图表呈现。

	设备运行状况分析:
	统计各站点正常/异常/低电/掉电设备数量以及百分比统计，各站点异常设备显示为列表查看。也可通过图表呈现。
	
**Galaxy系统agent模块详细设计**

	初始化业务在环境监控中间件（blueplanet-daemon）实现，依赖中间件现有的业务检测是否为新加入设备，如果是新的设备则发送请求至online。业务如下图
	
	![]({{site.mirror_url}}/assets/uploads/2015-02-25-products-cloud2.jpg)
	
	1、通过Quartz实现，在检测到新加入设备是启动独立任务调用http通信接口，多线程工作不影响中间件其他业务。
	2、如果online端没有公式，则根据返回结果上传设备所使用的默认公式。
	
**刷机精灵agent模块详细设计**

	![]({{site.mirror_url}}/assets/uploads/2015-02-25-products-cloud3.jpg)

	刷机精灵在配置硬件设备后上传配置的数据。
	功能描述：
	点击设置后，把数据写到硬件，收到硬件的成功恢复后，开始上传配置界面的所有信息。把界面 CuringParam 实体类转换成 json 格式，
	调用online Http接口，上传数据，同步等待，上传成功后提示用户。
	上传的实体类为CuringParam , 写入eeprom的固化参数。
	调用产品基本信息初始化API。
	
**技术调研**

	MongoDB
	MongoDB数据库维护
	Spring-data-mongoDB